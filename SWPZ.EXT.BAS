1 REM* MINDSWEEPER 1.0 Lauren Rad 2024
3 PCLEAR 2
4 CLEAR 700,15270
12 DIM OB(13,9)
13 DIM PB(13,9)
14 POKE280,PEEK(275)
16 CX=0:CY=0:A=0:I=0:J=0:X1=0:Y1=0:X1=0:Y2=0:X=0:Y=0:C1=0:SP=0:CD=0:TL=0:BD=0:SA=0:AA=0:TM=0
20 GOSUB12200
25 MC=15
55 ?"LOADING..."
60 GOSUB12500:GOSUB12600
70 GOSUB5000
75 '* NEWGAME
77 TL=(140)-MC
80 GOSUB9200
85 CX=1:CY=1
90 CLS:?"GENERATING BOARD...";
100 GOSUB1000
120 A=USR3(15470)
200 GOSUB12000
205 POKE341,255:POKE342,255:POKE343,255:POKE344,255:POKE345,255:POKE349,255:POKE340,255
215 GOSUB11200:GOSUB11300
300 '* LOOP
310 TM=TM+1
330 IF(PEEK(341)=247 OR PEEK(345)=251) AND CY>0 THENCD=0:GOSUB11300
335 IF(PEEK(343)=247 OR PEEK(339)=254) AND CX>0 THENCD=1:GOSUB11300
340 IF(PEEK(342)=247 OR PEEK(341)=251) AND CY<9 THENCD=2:GOSUB11300
345 IF(PEEK(344)=247 OR PEEK(342)=254) AND CX<13 THENCD=3:GOSUB11300
350 IFPEEK(344)=254 THENGOSUB900
355 IFPEEK(345)=247 THENGOSUB800
370 POKE341,255:POKE342,255:POKE343,255:POKE344,255:POKE345,255:POKE339,255:POKE340,255
390 GOTO300
395 END
400 '*
410 GOSUB12100
411 EXEC 44539
413 ?"CX=";CX;"CY=";CY
414 B$=""
415 FORI=0 TO 9
420 FORJ=0 TO 13
425 IFA=0 THENGOTO430
427 B$=B$+STR$(PB(J,I))
428 GOTO434
430 IFOB(J,I)=-1 THENB$=B$+" *" ELSEB$=B$+STR$(OB(J,I))
434 NEXT J
435 ?B$:B$=""
440 NEXT I
445 ? "TL=";TL;"TM=";TM
450 EXEC 44539
455 GOSUB12000
460 RETURN
800 '*
805 IFPB(CX,CY)=-3 THENSOUND 10,2:GOTO890
810 IFOB(CX,CY)=-1 THENGOTO1300
820 GOSUB1500
840 IFTL=0 THEN1400
890 RETURN
900 '*
910 IFPB(CX,CY)<>-3 AND PB(CX,CY)<>-4 THENSOUND 10,2:GOTO990
920 IFPB(CX,CY)=-4 THENGOTO930 ELSEGOTO950
925 GOTO990
930 PB(CX,CY)=-3
935 X1=(CX*9)+1:Y1=(CY*9)+1:SP=SA+64:SZ=8
940 GOSUB11800
945 GOTO990
950 PB(CX,CY)=-4
955 X1=(CX*9)+1:Y1=(CY*9)+1:X2=(CX*9)+8:Y2=(CY*9)+8:C1=0:GOSUB11500
990 RETURN
1000 '*
1005 FORX=0 TO 13:FORY=0 TO 9
1010 OB(X,Y)=0
1013 PB(X,Y)=-4
1015 NEXT Y,X
1020 A=MC
1025 X=RND(12)+1:Y=RND(9)
1030 IFOB(X,Y)=-1 THENGOTO1025
1040 OB(X,Y)=-1
1050 FORI=-1 TO 1:FORJ=-1 TO 1
1055 IFY+J<0 OR Y+J>9 THEN1080
1060 IFX+I<0 OR X+I>13 THEN1090
1070 IFOB(X+I,Y+J)<>-1 THENOB(X+I,Y+J)=OB(X+I,Y+J)+1
1073 IFOB(X+I,Y+J)>5 THEN1010
1075 ?".";
1080 NEXT J
1090 NEXT I
1100 A=A-1
1110 IFA>0 THEN1025
1210 RETURN
1300 '* GAME OVER
1305 GOSUB11700
1315 FORI=1 TO 5
1316 EXEC 42961:EXEC 42963
1317 NEXT I
1320 GOSUB12100
1330 T$="GAME OVER "
1340 CLS:GOTO12400
1400 '* WIN
1410 GOSUB12100
1415 T$="YOU  WON! "
1420 CLS
1425 ?@298,"TIME:  ";TM;
1430 GOTO12400
1500 '
1502 IFOB(CX,CY)=-5 THENGOTO1655
1505 CA=CX:CB=CY
1510 PB(CX,CY)=OB(CX,CY)
1520 TX=CX:TY=CY:GOSUB11600
1525 IFPB(CX,CY)<>0 THENTL=TL-1:OB(CX,CY)=-5:GOTO1650
1530 FORI=-1 TO 1
1535 IF(CX+I)<0 OR (CX+I)>13 THEN1575
1540 FORJ=-1 TO 1
1545 IF(CY+J)<0 OR (CY+J)>9 THEN1570
1550 IFOB(CX+I,CY+J)=-5 THEN1570
1555 TL=TL-1
1560 PB(CX+I,CY+J)=OB(CX+I,CY+J):OB(CX+I,CY+J)=-5
1562 TX=CX+I:TY=CY+J:GOSUB11600
1565 IFPB(CX+I,CY+J)=0 THENA=USR4(CX+I):A=USR4(CY+J)
1570 NEXT J
1575 NEXT I
1585 A=USR6(0)
1590 IFA=0 THENGOTO1650
1605 CY=USR5(0):CX=USR5(0)
1610 GOTO1530
1650 CX=CA:CY=CB
1655 RETURN
5000 '* SUB: TITLESCREEN
5010 CLS
5020 ?@102,"M I N D S W E E P E R":?@359,"(C)2024 LAUREN RAD":?@394,"PRESS ANY KEY"
5025 IFRND(100)<50 THENA$="*" ELSEA$=" "
5030 ?@RND(510),A$;
5040 IFINKEY$="" THENGOTO5020
5080 RETURN
9200 '* SUB: CLEAR VRAM
9220 POKEBD,6:POKEBD+1,0:POKEBD+2,18:POKEBD+3,0
9230 A=USR0(BD)
9240 RETURN
11200 '* DRAW GAME GRID
11215 POKEBD+3,1
11225 FORI=0 TO 90 STEP 9
11230 POKEBD+4,0:POKEBD+5,I:POKEBD+6,126:POKEBD+7,I
11235 A=USR1(BD)
11240 NEXT I
11255 FORI=0 TO 126 STEP 9
11260 POKEBD+4,I:POKEBD+5,0:POKEBD+6,I:POKEBD+7,90
11265 A=USR1(BD)
11270 NEXT I
11295 RETURN
11300 '* SUB: MOVE CURSOR
11305 C1=1
11310 X1=(CX*9):Y1=(CY*9):X2=(CX*9)+8:Y2=Y1:GOSUB11500
11311 X1=(CX*9)+9:Y1=(CY*9):X2=X1:Y2=(CY*9)+9:GOSUB11500
11312 X1=(CX*9):Y1=(CY*9)+9:X2=(CX*9)+9:Y2=Y1:GOSUB11500
11313 X1=(CX*9):Y1=(CY*9)+1:X2=X1:Y2=(CY*9)+8:GOSUB11500
11325 IFCD=0 THENCY=CY-1 ELSEIFCD=1 THENCX=CX-1 ELSEIFCD=2 THENCY=CY+1 ELSECX=CX+1
11370 X1=(CX*9):Y1=(CY*9):SP=SA+448:SZ=10:GOSUB11800
11385 RETURN
11500 '* SUB: DRAW RECT FROM X1,Y1 TO X2,Y2 COLOR C1
11510 POKEBD+3,C1:POKEBD+4,X1:POKEBD+5,Y1:POKEBD+6,X2:POKEBD+7,Y2
11525 A=USR1(BD)
11530 RETURN
11600 '* SUB: PUT USER BOARD TILE AT TX,TY ON SCREEN
11603 X1=(TX*9)+1:Y1=(TY*9)+1:A=PB(TX,TY)
11610 IFA=0 THENX2=X1+7:Y2=Y1+7:C1=2:GOSUB11500:GOTO11695
11615 IFA>0 THENSP=SA+64+(64*A):SZ=8:GOSUB11800
11695 RETURN
11700 '* SUB: DRAW MINES
11710 FORI=0 TO 13
11720 FORJ=0 TO 9
11725 IFOB(I,J)=-1 THENX1=(I*9)+1:Y1=(J*9)+1:SP=SA:SZ=8:GOSUB11800
11730 NEXT J,I
11735 RETURN
11800 '* DRAW SPRITE SP AT X1,Y1 SIZE SZ
11815 POKEBD+4,X1:POKEBD+5,Y1:POKEBD+6,SZ:POKEBD+7,SZ
11820 POKEBD+8,INT(SP/256):POKEBD+9,(SP AND 255)
11825 A=USR2(BD)
11890 RETURN
12000 '* SUB: ENTER GRAPHICS MODE G3C
12005 POKE65479,0:POKE65481,0:POKE65482,0:POKE65484,0:POKE65486,0:POKE65488,0:POKE65490,0
12015 POKE65472,0:POKE65474,0:POKE65477,0
12050 POKE65314,192 OR (PEEK(65314) AND 7)
12055 POKEBD+2,32:POKEBD+3,0
12090 RETURN
12100 ' *SUB: ENTER TEXT MODE
12105 POKE65478,0:POKE65481,0:POKE65482,0:POKE65484,0:POKE65486,0:POKE65488,0:POKE65490,0
12115 POKE65472,0:POKE65474,0:POKE65476,0
12120 POKE65314,0 OR (PEEK(65314) AND 7)
12160 RETURN
12200 ' *SUB: SETUP MEMORY ADDRESSES
12250 BD=16048
12255 SA=15472
12270 AA=16064
12280 DEFUSR0=AA
12285 DEFUSR1=AA+15
12290 DEFUSR2=AA+17
12295 DEFUSR3=AA+224
12300 DEFUSR4=AA+226
12305 DEFUSR5=AA+228
12310 DEFUSR6=AA+230
12390 RETURN
12400 ' *
12410 FORI=1 TO 22:SET(20+I,7,0):NEXT I
12420 FORI=1 TO 22:SET(20+I,10,0):NEXT I
12430 SET(21,8,0):SET(21,9,0):SET(42,8,0):SET(42,9,0)
12440 T$=RIGHT$(T$,1)+LEFT$(T$,LEN(T$)-1)
12450 ?@139,T$;
12455 ?@391,"PLAY AGAIN?  (Y/N)";
12460 EXEC 42963
12470 A$=INKEY$
12480 IFA$="Y" THENGOTO75
12490 IFA$="N" THENEND
12495 GOTO12440
12500 '* SUB: LOAD ASM ROUTINES
12510 FORI=0 TO 13:READ A:POKEAA+I,A:NEXT I
12511 DATA 189,179,237,31,3,174,196,111,128,172,66,38,250,57
12520 FORI=0 TO 198:READ A:POKEAA+15+I,A:NEXT I
12521 DATA 32,102,32,0,189,179,237,31,3,166,68,230,69,167,141
12522 DATA 0,176,231,141,0,173,174,72,166,128,129,9,39,4,167
12523 DATA 67,141,41,108,68,230,68,224,141,0,152,225,70,38,234
12524 DATA 166,141,0,144,167,68,108,69,230,69,224,141,0,135,225
12525 DATA 71,38,216,166,140,127,230,140,125,167,68,231,69,57,52
12526 DATA 119,141,66,141,87,52,2,230,67,61,53,2,52,4,198
12527 DATA 3,61,83,228,164,234,228,231,164,53,2,53,119,57,189
12528 DATA 179,237,31,3,166,68,167,140,79,230,69,141,212,166,68
12529 DATA 230,69,76,167,68,161,70,47,243,166,140,61,92,225,71
12530 DATA 34,6,167,68,231,69,32,229,57,52,87,166,66,230,69
12531 DATA 61,31,1,230,68,84,84,58,31,16,227,196,31,2,53
12532 DATA 87,57,52,113,134,252,164,68,52,2,230,68,224,228,83
12533 DATA 196,3,48,140,10,58,53,2,166,132,53,113,57,1,1,1,4,16,64
12540 FORI=0 TO 83:READ A:POKEAA+224+I,A:NEXT I
12541 DATA 32,6,32,14,32,42,32,63,189,179,237,237,140,68,237
12542 DATA 140,63,57,189,179,237,238,140,58,48,201,255,106,172,140
12543 DATA 51,38,5,204,255,255,32,7,54,4,79,95,239,140,37
12544 DATA 126,180,244,238,140,31,17,163,140,25,38,5,204,255,255
12545 DATA 32,6,55,4,29,239,140,14,126,180,244,236,140,6,163
12546 DATA 140,5,126,180,244,0,0,0,0
12550 RETURN
12600 '* SUB: LOAD SPRITES
12611 FORI=0 TO 63:READ A:POKESA+I,A:NEXT I
12612 DATA 3,0,0,0,0,0,0,3,0,3,0,3,3,0,3,0,0,0,3,3,3,3,0,0,0,3,3,1,3,3,3,0,0,3,3,3,3,3,3,0,0,0,3,3,3,3,0,0,0,3,0,3,3,0,3,0,3,0,0,0,0,0,0,3
12621 FORI=0 TO 63:READ A:POKESA+64+I,A:NEXT I
12622 DATA 9,2,9,9,9,9,9,9,9,2,3,9,9,9,9,9,9,2,3,3,9,9,9,9,9,2,3,3,3,3,9,9,9,2,3,3,3,3,3,9,9,2,9,9,9,9,9,9,9,2,9,9,9,9,9,9,9,2,9,9,9,9,9,9
12631 FORI=0 TO 63:READ A:POKESA+128+I,A:NEXT I
12632 DATA 2,2,2,2,9,2,2,2,2,2,2,9,9,2,2,2,2,2,9,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,9,9,9,9,2,2
12641 FORI=0 TO 63:READ A:POKESA+192+I,A:NEXT I
12642 DATA 2,2,9,9,9,9,2,2,2,9,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,9,9,2,2,2,2,9,9,2,2,2,2,2,9,9,2,2,2,2,2,2,9,9,9,9,9,9,2
12651 FORI=0 TO 63:READ A:POKESA+256+I,A:NEXT I
12652 DATA 2,2,9,9,9,9,2,2,2,9,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,9,9,9,9,2,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,9,2,2,2,2,9,2,2,2,9,9,9,9,2,2
12661 FORI=0 TO 63:READ A:POKESA+320+I,A:NEXT I
12662 DATA 2,2,2,2,2,9,2,2,2,2,2,2,9,9,2,2,2,2,2,9,2,9,2,2,2,2,9,2,2,9,2,2,2,9,9,9,9,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2
12671 FORI=0 TO 63:READ A:POKESA+384+I,A:NEXT I
12672 DATA 2,9,9,9,9,9,9,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,9,9,9,9,2,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,9,2,2,9,9,9,9,9,2,2
12681 FORI=0 TO 99:READ A:POKESA+448+I,A:NEXT I
12682 DATA 3,3,3,3,3,3,3,3,3,3,3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3
12683 DATA 3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,9,3,3,3,3,3,3,3,3,3,3,3
12690 RETURN
